<div>

  <div class="detailsDiv" id="eventSubmissionPage">

    <mat-card *ngIf="currentUser.role === 7">
      <h2>You do not have permission to create an event</h2>
      <p><button mat-raised-button color="primary" (click)="navigateToHome()">
          <mat-icon class="icon">home</mat-icon> Return Home
        </button></p>
    </mat-card>
    <mat-card *ngIf="currentUser.role !== 7">

      <div id="eventSubmissionHeader">
        <b>Create Event</b>
        <small>Submit a wildlife mortality/morbidity or surveillance event</small>
      </div>

      <mat-card-content>

        <form [formGroup]="eventSubmissionForm" autocomplete="off">

          <div class="horizontal-form-container">

            <mat-form-field class="form-control">
              <mat-select placeholder="Event Type" formControlName="event_type" required
                (ngModelChange)="updateEventType($event)">
                <mat-option *ngFor="let eventType of eventTypes" value="{{eventType.id}}">{{eventType.name}}
                </mat-option>
              </mat-select>
              <mat-icon class="hint-hover-text" matSuffix 
              matTooltip={{eventTypeTooltip()}} matTooltipClass="tooltip-breakline">
              help</mat-icon>
              <mat-hint align="end" matTooltip="Public field">
                <mat-icon>public</mat-icon>
              </mat-hint>
              <mat-error *ngIf="eventSubmissionForm.get('event_type').invalid">{{getErrorMessage('event_type')}}
              </mat-error>
            </mat-form-field>

            <mat-form-field class="form-control">
              <input matInput placeholder="User Event Reference" formControlName="event_reference">
              <mat-icon class="hint-hover-text" matSuffix 
              matTooltip={{userEventRefTooltip()}} matTooltipClass="tooltip-breakline">
              help</mat-icon>
              <mat-hint align="start">Reference name for this event (private) </mat-hint>
            </mat-form-field>
          </div>

          <div class="horizontal-form-container">
            <mat-form-field class="form-control">
              <mat-select placeholder="Event Visibility" formControlName="public" required>
                <mat-option [value]="true">Visible to Public</mat-option>
                <mat-option [value]="false">Not Visible to Public</mat-option>
              </mat-select>
              <mat-icon class="hint-hover-text" matSuffix 
              matTooltip={{eventVisibilityTooltip()}} matTooltipClass="tooltip-breakline">
              help</mat-icon>
              <mat-hint align="start"></mat-hint>
              <mat-error *ngIf="eventSubmissionForm.get('public').invalid">{{getErrorMessage('public')}}</mat-error>
            </mat-form-field>           
            <mat-form-field class="form-control">
              <mat-select placeholder="WHISPers Record Status" formControlName="complete" required
                (ngModelChange)="checkEventCompleteRules()">
                <mat-option [value]="true">Complete</mat-option>
                <mat-option [value]="false">Incomplete</mat-option>
              </mat-select>
              <mat-icon class="hint-hover-text" matSuffix 
              matTooltip={{recordStatusTooltip()}} matTooltipClass="tooltip-breakline">
              help</mat-icon>
              <mat-hint align="start"></mat-hint>
              <mat-hint align="end" matTooltip="Public field">
                <mat-icon>public</mat-icon>
              </mat-hint>
              <mat-error *ngIf="eventSubmissionForm.get('complete').invalid">{{getErrorMessage('complete')}}</mat-error>
            </mat-form-field>
          </div>

          <div formArrayName="new_organizations">
            <div *ngFor="let organization of getEventOrganizations(eventSubmissionForm); let eventOrgIndex = index">

              <div [formGroupName]="eventOrgIndex">

                <div class="horizontal-form-container">

                  <mat-form-field class="form-control event-org-select">
                    <mat-select placeholder="Contact Organization" formControlName="org" #orgSelect required>
                      <ngx-mat-select-search [formControl]="organizationFilterCtrl"
                        [placeholderLabel]="'Find organization...'"
                        [noEntriesFoundLabel]="'no matching organization found'"></ngx-mat-select-search>
                      <mat-option *ngFor="let organization of filteredOrganizations[eventOrgIndex] | async"
                        [value]="organization.id">
                        {{organization.name}}
                      </mat-option>
                    </mat-select>
                    <mat-icon class="hint-hover-text" matSuffix 
                    matTooltip={{contactOrganizationTooltip()}} matTooltipClass="tooltip-breakline">
              help</mat-icon>
                    <mat-hint align="start">
                      Contact organization for display to general public, for general inquries
                    </mat-hint>
                    <mat-hint align="end" matTooltip="Public field">
                      <mat-icon>public</mat-icon>
                    </mat-hint>
                  </mat-form-field>


                  <button mat-icon-button color="warn" aria-label="Remove this organization"
                    (click)="removeEventOrganization(eventOrgIndex)" matTooltip="Remove this organization"
                    *ngIf="eventOrgIndex > 0">
                    <mat-icon>remove_circle</mat-icon>
                  </button>
                </div>
              </div>
            </div>

            <div class="submissionReviewErrors">

              <mat-error color="warn" *ngIf="duplicateEventOrgViolation">
                <mat-icon class="icon">error</mat-icon>
                <span class="alert-text">Contact organization cannot be duplicated.</span>
              </mat-error>
            </div>
          </div>

          <div class="button-row">
            <button mat-button color="primary" matTooltip="Add contact organization" (click)="addEventOrganization()">
              <mat-icon>add_circle</mat-icon> Add Contact Organization
            </button>
          </div>

          <!-- NWHC staff only section -->
          <mat-card *ngIf="currentUser.role === 1 || currentUser.role === 2" class="nwhc-only">

            <div class="nwhc-only-header">
              NWHC Staff Only
            </div>
            <mat-card-content>
              <div class="horizontal-form-container">
                <form [formGroup]="eventSubmissionForm" autocomplete="off">

                  <div class="vertical-form-container">

                    <mat-form-field class="form-control">
                      <mat-select placeholder="Assigned NWHC Epidemiologist" formControlName="staff">
                        <mat-option *ngFor="let staffMember of staff" value="{{staffMember.id}}">
                          {{staffMember.first_name}}
                          {{staffMember.last_name}}</mat-option>
                      </mat-select>
                      <mat-hint align="start"></mat-hint>
                    </mat-form-field>
                  </div>
                  <div class="horizonal-form-container">

                    <mat-form-field class="form-control">
                      <mat-select placeholder="Process Status" formControlName="event_status" required>
                        <mat-option *ngFor="let status of eventStatuses" value="{{status.id}}">{{status.name}}
                        </mat-option>
                      </mat-select>
                      <mat-hint align="start"></mat-hint>
                    </mat-form-field>

                    <mat-form-field class="form-control">
                      <input matInput [matDatepicker]="qualityCheck" placeholder="NWHC Quality Check"
                        formControlName="quality_check">
                      <mat-datepicker-toggle matSuffix [for]="qualityCheck"></mat-datepicker-toggle>
                      <mat-datepicker #qualityCheck></mat-datepicker>
                      <mat-hint align="start" *ngIf="eventSubmissionForm.get('quality_check').disabled">Disabled if
                        event incomplete</mat-hint>
                    </mat-form-field>
                  </div>

                  <div class="horizontal-form-container">
                    <mat-form-field class="form-control">
                      <mat-select placeholder="Legal Status" formControlName="legal_status" required
                        (ngModelChange)="enforceLegalStatusRules($event)">
                        <mat-option *ngFor="let legalStatus of legalStatuses" [value]="legalStatus.id">
                          {{legalStatus.name}}
                        </mat-option>
                      </mat-select>
                      <mat-hint align="start"></mat-hint>
                    </mat-form-field>

                    <mat-form-field class="form-control">
                      <input matInput placeholder="Legal Number" formControlName="legal_number">
                      <mat-hint align="start"> </mat-hint>
                    </mat-form-field>
                  </div>

                </form>
              </div>
            </mat-card-content>
          </mat-card>
          <!-- End NWHC staff only section -->



        </form>

        <p>

          <!--Locations Section-->
          <div>
            <h3>
              <mat-icon>location_on</mat-icon> Event Locations
            </h3>
            <p>
              <form [formGroup]="eventSubmissionForm" class="event-submission-locations" autocomplete="off">
                <div formArrayName="new_event_locations">


                  <div
                    *ngFor="let eventLocation of getEventLocations(eventSubmissionForm); let eventLocationIndex = index"
                    class="event-location-box">
                    <!-- Begin repeating Event location markup-->
                    <mat-card class="event-location-card" [formGroupName]="eventLocationIndex">
                      <h3>Location {{eventLocationIndex+1}}</h3>
                      <mat-horizontal-stepper [linear]="false" #stepper linear>

                        <!-- Event location details step -->
                        <mat-step [stepControl]="eventSubmissionForm">

                          <ng-template matStepLabel>Location Details</ng-template>

                          <div class="horizontal-form-container">

                            <mat-form-field class="form-control">
                              <input matInput [matDatepicker]="startDate" placeholder="Location Start Date"
                                formControlName="start_date" (ngModelChange)="checkLocationStartDates()">
                              <mat-datepicker-toggle matSuffix [for]="startDate"></mat-datepicker-toggle>
                              <mat-datepicker #startDate></mat-datepicker>
                              <mat-icon class="hint-hover-text" matSuffix 
                                    matTooltip={{locationStartDateTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                              <mat-hint align="end" matTooltip="Public field">
                                <mat-icon>public</mat-icon>
                              </mat-hint>
                              <mat-error
                                *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('start_date').hasError('startDateTodayorEarlierMortalityEvent')">
                                Must
                                be today or earlier for morbidity/mortality events </mat-error>
                            </mat-form-field>
                            
                            <mat-form-field class="form-control">
                              <input matInput [matDatepicker]="endDate" placeholder="Location End Date"
                                formControlName="end_date" (ngModelChange)="checkLocationEndDates()">
                              <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
                              <mat-datepicker #endDate></mat-datepicker>
                              <mat-icon class="hint-hover-text" matSuffix 
                                    matTooltip={{locationEndDateTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                              <mat-hint align="end" matTooltip="Public field">
                                <mat-icon>public</mat-icon>
                              </mat-hint>
                              <mat-error
                                *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('end_date').hasError('endDateBeforeStart')">
                                Cannot
                                precede start date</mat-error>
                            </mat-form-field>
                          </div>
                          <br>

                          <div class="horizontal-form-container">

                            <mat-form-field class="form-control">
                              <mat-select placeholder="Country" formControlName="country"
                                (ngModelChange)="updateAdminLevelOneOptions($event, eventLocationIndex)" required>
                                <mat-option *ngFor="let country of countries" value="{{country.id}}">{{country.name}}
                                </mat-option>
                              </mat-select>
                              <mat-icon class="hint-hover-text" matSuffix 
                                    matTooltip={{countryTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                              <mat-hint align="end" matTooltip="Public field">
                                <mat-icon>public</mat-icon>
                              </mat-hint>
                              <mat-error
                                *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('country').invalid">
                                Please
                                enter a value</mat-error>
                            </mat-form-field>
                            <mat-form-field class="form-control">
                              <mat-spinner *ngIf="adminLevelOnesLoading" [diameter]="20"></mat-spinner>
                              <mat-select formControlName="administrative_level_one" placeholder="State (or equivalent)"
                                #adminLevelOneSelect
                                (ngModelChange)="updateAdminLevelTwoOptions($event, eventLocationIndex)" required>
                                <ngx-mat-select-search [formControl]="adminLevelOneFilterCtrl"
                                  [placeholderLabel]="'Find state...'"
                                  [noEntriesFoundLabel]="'no matching state found'"></ngx-mat-select-search>
                                <mat-option
                                  *ngFor="let admin_level_one of filteredAdminLevelOnes[eventLocationIndex] | async"
                                  [value]="admin_level_one.id">
                                  {{admin_level_one.name}}
                                </mat-option>
                              </mat-select>
                              <mat-icon class="hint-hover-text" matSuffix 
                                    matTooltip={{stateTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                              <mat-hint align="start">Select a country to populate/update state list </mat-hint>
                              <mat-hint align="end" matTooltip="Public field">
                                <mat-icon>public</mat-icon>
                              </mat-hint>
                              <mat-error
                                *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('administrative_level_one').invalid">
                                Please
                                enter a value</mat-error>
                            </mat-form-field>

                            <mat-form-field class="form-control">
                              <mat-spinner *ngIf="adminLevelTwosLoading" [diameter]="20"></mat-spinner>
                              <mat-select formControlName="administrative_level_two"
                                placeholder="County (or equivalent)" #adminLevelTwoSelect required>
                                <ngx-mat-select-search [formControl]="adminLevelTwoFilterCtrl"
                                  [placeholderLabel]="'Find county...'"
                                  [noEntriesFoundLabel]="'no matching county found'"></ngx-mat-select-search>
                                <mat-option
                                  *ngFor="let admin_level_two of filteredAdminLevelTwos[eventLocationIndex] | async"
                                  [value]="admin_level_two.id">
                                  {{admin_level_two.name}}
                                </mat-option>
                              </mat-select>
                              <mat-icon class="hint-hover-text" matSuffix 
                                    matTooltip={{countyTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                              <mat-hint align="start">Select a state to populate/update county list </mat-hint>
                              <mat-hint align="end" matTooltip="Public field">
                                <mat-icon>public</mat-icon>
                              </mat-hint>
                              <mat-error
                                *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('administrative_level_two').invalid">
                                Please
                                enter a value</mat-error>
                            </mat-form-field>

                          </div>

                          <div class="vertical-form-container">
                            <mat-form-field class="form-control">
                              <input matInput placeholder="Location Name" formControlName="name">
                              <mat-icon class="hint-hover-text" matSuffix 
                                    matTooltip={{locationNameTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                            </mat-form-field>

                            <mat-form-field class="form-control">
                              <mat-select placeholder="Land Ownership" formControlName="land_ownership" required>
                                <mat-option *ngFor="let landOwnership of landOwnerships" value="{{landOwnership.id}}">
                                  {{landOwnership.name}}</mat-option>
                              </mat-select>
                              <mat-icon class="hint-hover-text" matSuffix 
                                    matTooltip={{landOwnershipTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                              <mat-error
                                *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('land_ownership').invalid">
                                Please
                                enter a value</mat-error>
                            </mat-form-field>

                          </div>

                          <div class="horizontal-form-container">
                            <mat-form-field class="form-control">
                              <input matInput placeholder="Latitude" formControlName="latitude">
                              <mat-icon class="hint-hover-text" matSuffix 
                                    matTooltip={{latitudeTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                              <mat-error
                                *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('latitude').invalid">
                                Invalid
                                latitude</mat-error>
                            </mat-form-field>

                            <mat-form-field class="form-control">
                              <input matInput placeholder="Longitude" formControlName="longitude">
                              <mat-icon class="hint-hover-text" matSuffix 
                                    matTooltip={{longitudeTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                              <mat-error
                                *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('longitude').invalid">
                                Invalid
                                longitude</mat-error>
                            </mat-form-field>
                          </div>

                          <h4>GNIS Standardized Location Name<mat-icon class="hint-hover-text" matSuffix 
                            matTooltip={{standardizedLocationNameTooltip()}} matTooltipClass="tooltip-breakline">
                            help</mat-icon>
                          </h4>

                          <button mat-stroked-button color="primary"
                            aria-label="Look up feature in Geographic Names Information System (GNIS) database"
                            matTooltip="Look up feature in Geographic Names Information System (GNIS) database"
                            (click)="openGNISLookupDialog(eventLocationIndex)">
                            <mat-icon>search</mat-icon>Look Up GNIS
                          </button>

                          <button mat-stroked-button class="gnisid" color="primary"
                            aria-label="Clear Geographic Names Information System (GNIS) entry"
                            matTooltip="Clear Geographic Names Information System (GNIS) entry"
                            (click)="clearGNISEntry(eventLocationIndex)">
                            <mat-icon>clear_all</mat-icon>Clear GNIS entry
                          </button>

                          <div class="horizontal-form-container">
                            <mat-form-field class="form-control">
                              <input matInput placeholder="GNIS Feature Name" formControlName="gnis_name" readonly>
                              <mat-hint align="start">Use Look Up GNIS tool to populate </mat-hint>

                            </mat-form-field>

                            <mat-form-field class="form-control">
                              <input matInput placeholder="GNIS Feature ID" formControlName="gnis_id" readonly>
                              <mat-hint align="start">Use Look Up GNIS tool to populate </mat-hint>
                            </mat-form-field>
                          </div>

                          <div class="form-nav-buttons">
                            <button mat-button mat-flat-button matStepperNext type="button"> Next
                              <mat-icon> navigate_next </mat-icon>
                            </button>
                          </div>

                        </mat-step>
                        <!-- end Event location details step -->

                        <!-- event location species step -->
                        <mat-step [stepControl]="eventSubmissionForm">

                          <ng-template matStepLabel>Species</ng-template>
                          <div>

                            <div formArrayName="new_location_species">
                              <div class="species-container"
                                *ngFor="let locationSpecies of getLocationSpecies(eventLocation); let locationSpeciesIndex = index">

                                <div [formGroupName]="locationSpeciesIndex">

                                  <div class="horizontal-form-container" class="species-controls-container">

                                    <mat-form-field class="form-control">
                                      <mat-select formControlName="species" placeholder="Species" #speciesSelect
                                        required>
                                        <ngx-mat-select-search [formControl]="speciesFilterCtrl"
                                          [placeholderLabel]="'Find species...'"
                                          [noEntriesFoundLabel]="'no matching species found'"></ngx-mat-select-search>
                                        <mat-option
                                          *ngFor="let species of filteredSpecies[eventLocationIndex][locationSpeciesIndex] | async"
                                          [value]="species.id">
                                          {{species.name}}
                                        </mat-option>
                                      </mat-select>
                                      <mat-icon class="hint-hover-text" matSuffix 
                                      matTooltip={{speciesTooltip()}} matTooltipClass="tooltip-breakline">
                                      help</mat-icon>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('species').hasError('required')">
                                        Species
                                        selection is required</mat-error>
                                    </mat-form-field>

                                    <!--Known Dead control -->
                                    <mat-form-field class="species-number-control-w-help">
                                      <input matInput placeholder="Known Dead" type="number" min="0"
                                        formControlName="dead_count" (ngModelChange)="checkLocationSpeciesNumbers()">
                                        <mat-icon class="hint-hover-text" matSuffix 
                                        matTooltip={{knownDeadTooltip()}} matTooltipClass="tooltip-breakline">
                                        help</mat-icon>
                                      <mat-hint align="end" matTooltip="Public field">
                                        <mat-icon>public</mat-icon>
                                      </mat-hint>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('dead_count').hasError('min')">
                                        Minimum
                                        value is 0</mat-error>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('dead_count').hasError('integer')">
                                        Must
                                        be an integer (whole number)</mat-error>
                                    </mat-form-field>
                                    <!--End Known Dead control -->

                                    <!-- Estimated Dead control -->
                                    <mat-form-field class="species-number-control-w-help">
                                      <input matInput placeholder="Estimated Dead" type="number" min="0"
                                        formControlName="dead_count_estimated"
                                        (ngModelChange)="checkLocationSpeciesNumbers()">
                                        <mat-icon class="hint-hover-text" matSuffix 
                                        matTooltip={{estimatedDeadTooltip()}} matTooltipClass="tooltip-breakline">
                                        help</mat-icon>
                                      <mat-hint align="end" matTooltip="Public field">
                                        <mat-icon>public</mat-icon>
                                      </mat-hint>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('dead_count_estimated').hasError('min')">
                                        Minimum
                                        value is 0</mat-error>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('dead_count_estimated').hasError('integer')">
                                        Must
                                        be an integer (whole number)</mat-error>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('dead_count_estimated').hasError('estimatedDead')">
                                        Must
                                        be higher than known dead</mat-error>
                                    </mat-form-field>
                                    <!--End Estimated Dead control -->

                                    <!--Known Sick control -->
                                    <mat-form-field class="species-number-control-w-help">
                                      <input matInput placeholder="Known Sick" type="number" min="0"
                                        formControlName="sick_count" (ngModelChange)="checkLocationSpeciesNumbers()">
                                        <mat-icon class="hint-hover-text" matSuffix 
                                        matTooltip={{knownSickTooltip()}} matTooltipClass="tooltip-breakline">
                                        help</mat-icon>
                                      <mat-hint align="end" matTooltip="Public field">
                                        <mat-icon>public</mat-icon>
                                      </mat-hint>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('sick_count').hasError('min')">
                                        Minimum
                                        value is 0</mat-error>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('sick_count').hasError('integer')">
                                        Must
                                        be an integer (whole number)</mat-error>
                                    </mat-form-field>
                                    <!--End Known Sick control -->

                                    <!--Estimated sick control-->
                                    <mat-form-field class="species-number-control-w-help">
                                      <input matInput placeholder="Estimated Sick" type="number" min="0"
                                        formControlName="sick_count_estimated"
                                        (ngModelChange)="checkLocationSpeciesNumbers()">
                                        <mat-icon class="hint-hover-text" matSuffix 
                                        matTooltip={{estimatedSickTooltip()}} matTooltipClass="tooltip-breakline">
                                        help</mat-icon>
                                      <mat-hint align="end" matTooltip="Public field">
                                        <mat-icon>public</mat-icon>
                                      </mat-hint>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('sick_count_estimated').hasError('min')">
                                        Minimum
                                        value is 0</mat-error>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('sick_count_estimated').hasError('integer')">
                                        Must
                                        be an integer (whole number)</mat-error>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('sick_count_estimated').hasError('estimatedSick')">
                                        Must
                                        be higher than known sick</mat-error>
                                    </mat-form-field>
                                    <!--End Estimated sick control-->

                                    <!--Population count control-->
                                    <mat-form-field class="species-bias-control">
                                      <input matInput placeholder="Population" type="number" min="0"
                                        formControlName="population_count">
                                        <mat-icon class="hint-hover-text" matSuffix 
                                        matTooltip={{populationTooltip()}} matTooltipClass="tooltip-breakline">
                                        help</mat-icon>
                                      <mat-hint align="end" matTooltip="Public field">
                                        <mat-icon>public</mat-icon>
                                      </mat-hint>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('population_count').hasError('min')">
                                        Minimum
                                        value is 0</mat-error>
                                      <mat-error
                                        *ngIf="this.eventSubmissionForm.get('new_event_locations')['controls'][eventLocationIndex].get('new_location_species')['controls'][locationSpeciesIndex].get('population_count').hasError('integer')">
                                        Must
                                        be an integer (whole number)</mat-error>
                                    </mat-form-field>
                                    <!--End Population count control-->

                                    <!-- Age Bias Control -->
                                    <mat-form-field class="species-bias-control">
                                      <mat-select placeholder="Age Bias" formControlName="age_bias">
                                        <mat-option [value]="null">--</mat-option>
                                        <mat-option *ngFor="let ageBias of ageBiases" value="{{ageBias.id}}">
                                          {{ageBias.name}}</mat-option>
                                      </mat-select>
                                      <mat-icon class="hint-hover-text" matSuffix 
                                        matTooltip={{ageBiasTooltip()}} matTooltipClass="tooltip-breakline">
                                        help</mat-icon>
                                      <mat-hint align="end" matTooltip="Public field">
                                        <mat-icon>public</mat-icon>
                                      </mat-hint>
                                    </mat-form-field>
                                    <!-- End Age Bias Control -->

                                    <!--Sex bias control-->
                                    <mat-form-field class="species-number-control">
                                      <mat-select placeholder="Sex Bias" formControlName="sex_bias">
                                        <mat-option [value]="null">--</mat-option>
                                        <mat-option *ngFor="let sexBias of sexBiases" value="{{sexBias.id}}">
                                          {{sexBias.name}}</mat-option>
                                      </mat-select>
                                      <mat-icon class="hint-hover-text" matSuffix 
                                        matTooltip={{sexBiasTooltip()}} matTooltipClass="tooltip-breakline">
                                        help</mat-icon>
                                      <mat-hint align="end" matTooltip="Public field">
                                        <mat-icon>public</mat-icon>
                                      </mat-hint>
                                    </mat-form-field>
                                    <!--End Sex bias control-->

                                    <!--Captive control-->
                                    <mat-form-field class="form-control-short">
                                      <mat-select placeholder="Captive" formControlName="captive"
                                        (ngModelChange)="enforceCaptiveRule($event)">
                                        <mat-option [value]="true">Captive > 72 hours</mat-option>
                                        <mat-option [value]="false">Wild and/or free-ranging</mat-option>
                                      </mat-select>
                                      <mat-icon class="hint-hover-text" matSuffix 
                                        matTooltip={{captiveTooltip()}} matTooltipClass="tooltip-breakline">
                                        help</mat-icon>
                                      <mat-hint align="end" matTooltip="Public field">
                                        <mat-icon>public</mat-icon>
                                      </mat-hint>
                                    </mat-form-field>
                                    <!--End Captive control-->

                                    <div class="contact-button-div">
                                      <button mat-icon-button color="accent" aria-label="Apply species to all locations"
                                        matTooltip="Apply species to all locations"
                                        (click)="createCommonEventDataObject('species', eventLocationIndex, locationSpeciesIndex )">
                                        <mat-icon>group_work</mat-icon>
                                      </button>

                                      <button mat-icon-button color="warn"
                                        aria-label="Remove this species from this location"
                                        (click)="removeLocationSpecies(eventLocationIndex, locationSpeciesIndex)"
                                        matTooltip="Remove this species from this location">
                                        <mat-icon>remove_circle</mat-icon>
                                      </button>
                                    </div>
                                  </div>

                                </div>
                              </div>
                            </div>
                          </div>

                          <div class="submissionReviewErrors">
                            <mat-error color="warn"
                              *ngIf="this.eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('new_location_species').hasError('minSpecies')">
                              <mat-icon class="icon">error</mat-icon>
                              <span class="alert-text">Location must have at least one species.</span>
                            </mat-error>
                          </div>

                          <div class="button-row">
                            <button mat-button color="primary" matTooltip="Add species to this location"
                              (click)="addLocationSpecies(eventLocationIndex)">
                              <mat-icon>add_circle</mat-icon> Add Species
                            </button>
                          </div>
                          <div class="form-nav-buttons">
                            <button mat-button matStepperPrevious type="button">
                              <mat-icon> navigate_before </mat-icon> Back
                            </button>
                            <button mat-button mat-flat-button matStepperNext type="button"> Next
                              <mat-icon> navigate_next </mat-icon>
                            </button>
                          </div>

                        </mat-step>
                        <!-- end event location species step -->

                        <!-- event location species diagnosis step -->
                        <mat-step [stepControl]="eventSubmissionForm">

                          <ng-template matStepLabel>Species Diagnosis</ng-template>
                          <div
                            *ngIf="getLocationSpecies(eventLocation).length === 0 || getLocationSpecies(eventLocation)[0].get('species').value === null">
                            <span class="text-large text-bold">Species Diagnoses: No species selected</span><br><span
                              class="text-smaller">Return
                              to previous step to select a species</span>
                          </div>

                          <div
                            *ngIf="getLocationSpecies(eventLocation).length > 0 && getLocationSpecies(eventLocation)[0].get('species').value !== null">
                            <span class="text-large text-bold">Species Diagnoses</span>

                            <div formArrayName="new_location_species">
                              <div
                                *ngFor="let locationSpecies of getLocationSpecies(eventLocation); let locationSpeciesIndex = index">

                                <div class="species-container" [formGroupName]="locationSpeciesIndex"
                                  *ngIf="locationSpecies.get('species').value !== null">

                                  <div class="horizontal-form-container" class="species-controls-container">

                                    <div>
                                      <span class="text-larger text-bold">{{locationSpecies.get('species').value |
                                        displayValue:'name':this.species}}</span>

                                      <!-- div for displaying species diagnoses added to the location species -->
                                      <div *ngIf="getSpeciesDiagnoses(locationSpecies).length > 0">

                                        <table class="species-diagnosis-table">
                                          <tr>
                                            <th>Species Diagnosis</th>
                                            <th>Significance of Diagnosis for Species</th>
                                            <th>Basis of Diagnosis</th>
                                            <th>Number Assessed</th>
                                            <th>Number with this diagnosis</th>
                                            <th>Species Diagnosis Suspect </th>
                                            <th>Diagnosing Lab </th>
                                            <th>Edit</th>
                                            <th>Delete</th>
                                          </tr>

                                          <tr
                                            *ngFor="let speciesDiagnosis of getSpeciesDiagnoses(locationSpecies); let speciesDiagnosisIndex = index">
                                            <td>{{speciesDiagnosis.get('diagnosis').value |
                                              displayValue:'name':this.allDiagnoses}}&nbsp;<span
                                                *ngIf="speciesDiagnosis.get('suspect').value">suspect</span></td>
                                            <td>{{speciesDiagnosis.get('cause').value |
                                              displayValue:'name':this.diagnosisCauses}}</td>
                                            <td>{{speciesDiagnosis.get('basis').value |
                                              displayValue:'name':this.diagnosisBases}}</td>
                                            <td>{{speciesDiagnosis.get('tested_count').value}}</td>
                                            <td>{{speciesDiagnosis.get('diagnosis_count').value}}</td>
                                            <td>{{speciesDiagnosis.get('suspect').value ? 'Yes' : 'No'}}</td>
                                            <td>
                                              <ul *ngIf="getDiagnosisOrganizations(speciesDiagnosis)"
                                                class="table-cell-list">
                                                <li
                                                  *ngFor="let organizationID of getDiagnosisOrganizations(speciesDiagnosis); let diagnosisOrganizationIndex = index;">{{organizationID
                                                  | displayValue:'name':this.organizations}}</li><br>
                                              </ul>
                                            </td>
                                            <td>
                                              <button mat-icon-button aria-label="Edit species diagnosis" color="accent"
                                                (click)="editSpeciesDiagnosis(eventLocationIndex, locationSpeciesIndex, speciesDiagnosisIndex, speciesDiagnosis, locationSpecies)">
                                                <mat-icon>edit</mat-icon>
                                              </button>
                                            </td>
                                            <td>
                                              <button mat-icon-button aria-label="delete species diagnosis" color="warn"
                                                (click)="openSpeciesDiagnosisRemoveConfirm(eventLocationIndex, locationSpeciesIndex, speciesDiagnosisIndex)">
                                                <mat-icon>remove_circle</mat-icon>
                                              </button>
                                            </td>
                                          </tr>
                                        </table>
                                      </div>
                                    </div>
                                    <!-- Add species diagnosis button -->
                                    <div class="button-row">
                                      <button mat-button color="primary" matTooltip="Add diagnosis to this species"
                                        (click)="openAddSpeciesDiagnosisDialog(eventLocationIndex,locationSpeciesIndex)">
                                        <mat-icon>add_circle</mat-icon> Add Diagnosis
                                      </button>
                                    </div>
                                    <!-- End Add species diagnosis button -->
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>

                          <div class="submissionReviewErrors">
                            <mat-error color="warn"
                              *ngIf="this.eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('new_location_species').hasError('minSpecies')">
                              <mat-icon class="icon">error</mat-icon>
                              <span class="alert-text">Location must have at least one species.</span>
                            </mat-error>
                          </div>

                          <div class="form-nav-buttons">
                            <button mat-button matStepperPrevious type="button">
                              <mat-icon> navigate_before </mat-icon> Back
                            </button>
                            <button mat-button mat-flat-button matStepperNext type="button"> Next
                              <mat-icon> navigate_next </mat-icon>
                            </button>
                          </div>

                        </mat-step>
                        <!-- end event location species diagnosis step -->

                        <!-- event location comments step -->
                        <mat-step [stepControl]="eventSubmissionForm">
                          <ng-template matStepLabel>Comments</ng-template>

                          <div id="submissionCommentsForm">
                            <p>
                              Text in at least one of the comment categories below is required. Please be as thorough
                              as possible to aid interpretation of data and to potentially guide cause of death
                              determination and management actions.
                              <mat-icon class="hint-hover-text" matSuffix 
                              matTooltip={{locationCommentTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                            </p>

                            <mat-form-field class="comment-text-area">
                              <textarea matInput #areaDescription maxlength="1000" rows="4" placeholder="History"
                                formControlName="history"></textarea>
                              <mat-hint align="start" class="hint">
                                <strong>chronological description of current observational information leading up to
                                  finding sick
                                  or dead wildlife, plus historical information about past events</strong>
                              </mat-hint>
                              <mat-hint align="end">{{areaDescription.value.length}} / 1000</mat-hint>
                              <!-- <mat-error *ngIf="this.eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('history').hasError('minComment')">At least one comment field must have a value</mat-error> -->
                            </mat-form-field>

                            <mat-form-field class="comment-text-area">
                              <textarea matInput #areaDescription maxlength="1000" rows="4"
                                placeholder="Site Description" formControlName="site_description"></textarea>
                              <mat-hint align="start" class="hint">
                                <strong> animal and human land use (e.g., other species present, hunting and
                                  agricultural activities),
                                  habitat types (e.g., vegetation, water features), nearby structures (e.g.,
                                  buildings,
                                  power lines, wind turbines), public health warnings, or other major characteristics
                                  of
                                  the area</strong>
                              </mat-hint>
                              <mat-hint align="end">{{areaDescription.value.length}} / 1000</mat-hint>
                              <!-- <mat-error *ngIf="this.eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('site_description').hasError('minComment')">At least one comment field must have a value</mat-error> -->
                            </mat-form-field>


                            <mat-form-field class="comment-text-area">
                              <textarea matInput #envFactors maxlength="1000" rows="4"
                                placeholder="Environmental Factors" formControlName="environmental_factors"></textarea>
                              <mat-hint align="start">
                                <strong>storms, precipitation, temperature changes, migration, toxins, or other
                                  factors that
                                  may contribute to stress in the animals
                                </strong>
                              </mat-hint>
                              <mat-hint align="end">{{envFactors.value.length}} / 1000</mat-hint>
                              <!-- <mat-error *ngIf="this.eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('environmental_factors').hasError('minComment')">At least one comment field must have a value</mat-error> -->
                            </mat-form-field>



                            <mat-form-field class="comment-text-area">
                              <textarea matInput #clinicalSigns maxlength="1000" rows="4" placeholder="Clinical Signs"
                                formControlName="clinical_signs"></textarea>
                              <mat-hint align="start">
                                <strong>any unusual behavior or physical appearance in the animals</strong>
                              </mat-hint>
                              <mat-hint align="end">{{clinicalSigns.value.length}} / 1000</mat-hint>
                              <!-- <mat-error *ngIf="this.eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('clinical_signs').hasError('minComment')">At least one comment field must have a value</mat-error> -->
                            </mat-form-field>

                            <mat-form-field class="comment-text-area">
                              <textarea matInput #generalComment maxlength="1000" rows="4"
                                placeholder="Additonal Comment" formControlName="comment"></textarea>
                              <mat-hint align="start">
                                <strong>any additional comment not covered by the fields above</strong>
                              </mat-hint>
                              <mat-hint align="end">{{generalComment.value.length}} / 1000</mat-hint>
                            </mat-form-field>

                            <div class="submissionReviewErrors">
                              <mat-error color="warn" *ngIf="checkEventLocationCommentMin(eventLocationIndex)">
                                <mat-icon class="icon">error</mat-icon>
                                <span class="alert-text">At least one comment field must have a value</span>
                              </mat-error>
                            </div>

                          </div>

                          <div class="form-nav-buttons">
                            <button mat-button matStepperPrevious type="button">
                              <mat-icon> navigate_before </mat-icon> Back
                            </button>
                            <button mat-button mat-flat-button matStepperNext type="button"> Next
                              <mat-icon> navigate_next </mat-icon>
                            </button>
                          </div>

                        </mat-step>
                        <!--end event location comments step -->

                        <!-- event location contacts step -->
                        <mat-step [stepControl]="eventSubmissionForm">

                          <ng-template matStepLabel>Contacts</ng-template>

                          <div class="add-content-button">
                            <button mat-button color="primary" class="event-detail-action-button"
                              (click)="openCreateContactDialog()">
                              <mat-icon>person_add</mat-icon> Create New Contact
                            </button>
                            <mat-icon class="hint-hover-text" style="top: 40px;" matSuffix 
                              matTooltip={{contactPersonTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                          </div>

                          <div formArrayName="new_location_contacts">
                            <div class="contacts-container"
                              *ngFor="let locationContacts of getLocationContacts(eventLocation); let locationContactIndex = index">
                              <div class="horizontal-form-container contact-controls-container"
                                [formGroupName]="locationContactIndex">

                                <!-- new experimental contact search select -->
                                <mat-form-field class="contact-select">
                                  <mat-select formControlName="contact" placeholder="Contact Person" #contactSelect>
                                    <ngx-mat-select-search [formControl]="contactFilterCtrl"
                                      [placeholderLabel]="'Find contact...'"
                                      [noEntriesFoundLabel]="'no matching contact found'"></ngx-mat-select-search>
                                    <mat-option
                                      *ngFor="let contact of filteredContacts[eventLocationIndex][locationContactIndex] | async"
                                      [value]="contact.id">
                                      <span>{{contact.first_name}}
                                        {{contact.last_name}} | <span
                                          class="text-smaller">{{contact.organization_string}}</span></span>
                                    </mat-option>
                                  </mat-select>
                                </mat-form-field>
                                <!-- end new experimental contact search select -->

                                <mat-form-field class="form-control  contact-type-select">
                                  <mat-select placeholder="Contact Type" formControlName="contact_type">
                                    <mat-option *ngFor="let contactType of contactTypes" [value]="contactType.id">
                                      {{contactType.name}}</mat-option>
                                  </mat-select>
                                  <mat-icon class="hint-hover-text" matSuffix 
                                        matTooltip={{contactTypeTooltip()}} matTooltipClass="tooltip-breakline">
                                        help</mat-icon>
                                </mat-form-field>

                                <div class="contact-button-div">
                                  <button mat-icon-button color="accent" aria-label="View contact details"
                                    matTooltip="View contact details"
                                    (click)="viewContactDetailsDialog(eventLocationIndex, locationContactIndex)">
                                    <mat-icon>assignment_ind</mat-icon>
                                  </button>
                                  <button mat-icon-button color="accent" aria-label="Apply contact to all locations"
                                    matTooltip="Apply contact to all locations"
                                    (click)="createCommonEventDataObject('contact', eventLocationIndex, locationContactIndex)">
                                    <mat-icon>group_work</mat-icon>
                                  </button>
                                  <button mat-icon-button color="warn"
                                    aria-label="Remove this contact from this location"
                                    (click)="removeLocationContact(eventLocationIndex, locationContactIndex)"
                                    matTooltip="Remove this contact from this location">
                                    <mat-icon>remove_circle</mat-icon>
                                  </button>
                                </div>

                              </div>

                              <br>
                            </div>
                          </div>

                          <div class="add-content-button small">
                            <button mat-button color="primary" matTooltip="Add contact to this location"
                              (click)="addLocationContact(eventLocationIndex)" [disabled]="userContactsLoading">
                              <span *ngIf="!userContactsLoading">
                                <mat-icon>add_circle</mat-icon> Add Contact
                              </span>
                              <span *ngIf="userContactsLoading">
                                <mat-spinner [diameter]=20 style="margin: 0 auto;"></mat-spinner>
                                <span>Loading contacts list...</span>
                              </span>
                            </button>
                            <mat-icon class="hint-hover-text" style="top: 45px;" matSuffix 
                              matTooltip={{contactPersonTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                          </div>

                          <div class="form-nav-buttons">
                            <button mat-button matStepperPrevious type="button">
                              <mat-icon> navigate_before </mat-icon> Back
                            </button>
                            <button mat-button mat-flat-button matStepperNext type="button"> Next
                              <mat-icon> navigate_next </mat-icon>
                            </button>
                          </div>

                        </mat-step>
                        <!-- end event location contacts step -->

                        <!-- Review step -->
                        <mat-step>
                          <ng-template matStepLabel>Review</ng-template>

                          <div id="submissionReviewComplete"
                            *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].valid && checkEventLocationCommentMin(eventLocationIndex) === false">
                            <mat-icon>check</mat-icon>
                            <b>Finished with Location {{eventLocationIndex+1}}</b>
                          </div>

                          <div class="submissionReviewErrors">
                            <mat-error
                              *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('country').invalid">
                              <mat-icon class="icon">error</mat-icon>
                              <span class="alert-text">Missing country selection.</span>
                            </mat-error>

                            <mat-error color="warn"
                              *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('administrative_level_one').invalid">
                              <mat-icon class="icon">error</mat-icon>
                              <span class="alert-text">Missing state selection.</span>
                            </mat-error>

                            <mat-error color="warn"
                              *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('administrative_level_one').invalid">
                              <mat-icon class="icon">error</mat-icon>
                              <span class="alert-text">Missing county selection.</span>
                            </mat-error>

                            <mat-error color="warn"
                              *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('land_ownership').invalid">
                              <mat-icon class="icon">error</mat-icon>
                              <span class="alert-text">Missing land ownership selection.</span>
                            </mat-error>

                            <mat-error color="warn"
                              *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('new_location_species').hasError('minSpecies')">
                              <mat-icon class="icon">error</mat-icon>
                              <span class="alert-text">Location must have at least one species.</span>
                            </mat-error>

                            <mat-error color="warn" *ngIf="checkforMissingSpecies(eventLocationIndex)">
                              <mat-icon class="icon">error</mat-icon>
                              <span class="alert-text">Missing species selection.</span>
                            </mat-error>

                            <mat-error color="warn" *ngIf="checkEventLocationCommentMin(eventLocationIndex)">
                              <mat-icon class="icon">error</mat-icon>
                              <span class="alert-text">At least one comment field must have a value.</span>
                            </mat-error>

                            <!-- <mat-error color="warn" *ngIf="eventSubmissionForm.get('new_event_locations').controls[eventLocationIndex].get('new_location_contacts').invalid">
                                <mat-icon class="icon">error</mat-icon>
                                <span class="alert-text">Missing contact type selection.</span>
                              </mat-error> -->
                          </div>


                          <div class="form-nav-buttons">
                            <button mat-button matStepperPrevious type="button">
                              <mat-icon> navigate_before </mat-icon> Back
                            </button>
                            <!-- <button mat-button (click)="stepper.reset()">Reset</button> -->
                            <!-- <button mat-button color="primary" matTooltip="Add another location to this event"
                                    (click)="addEventLocation()">
                                    <mat-icon>add_location</mat-icon>Add Another Location
                                  </button> -->
                          </div>
                        </mat-step>
                        <!-- end Review step -->

                      </mat-horizontal-stepper>

                      <div class="remove-location-button">
                        <button mat-button color="warn" (click)="openEventLocationRemoveConfirm(eventLocationIndex)">
                          <mat-icon>remove_circle</mat-icon> Remove this Event Location
                        </button>
                      </div>

                    </mat-card>
                    <!-- End repeating Event location markup-->
                  </div>


                </div>
              </form>
          </div>
          <!-- End Locations Section-->

          <div class="add-content-button">
            <button mat-button color="primary" matTooltip="Add another location to this event"
              (click)="addEventLocation()">
              <mat-icon>add_location</mat-icon>Add Event Location
            </button>
          </div>


          <!-- Begin event diagnoses section-->
          <h3>
            <mat-icon>note</mat-icon> Event Diagnosis
          </h3>
          <p>
            <mat-card>
              <!-- <mat-card-header>
                <mat-card-title>Event Diagnosis</mat-card-title>
              </mat-card-header> -->
              <mat-card-content>
                <div class="horizontal-form-container">
                  <form [formGroup]="eventSubmissionForm" style="width:100%;" autocomplete="off">

                    <div formArrayName="new_event_diagnoses">
                      <div
                        *ngFor="let eventDiagnosis of getEventDiagnoses(eventSubmissionForm); let eventDiagnosisIndex = index">

                        <div [formGroupName]="eventDiagnosisIndex">

                          <div class="horizontal-form-container">

                            <mat-form-field class="form-control event-diagnosis-select">
                              <mat-select placeholder="Event Diagnosis" formControlName="diagnosis">
                                <mat-option *ngFor="let diagnosis of availableDiagnoses" value="{{diagnosis.id}}"
                                  [disabled]="checkForDuplicateEventDiagnosis(diagnosis.id)">
                                  {{diagnosis.name}}<span *ngIf="diagnosis.suspect"> (suspect)</span></mat-option>
                              </mat-select>
                              <mat-icon class="hint-hover-text" matSuffix 
                                matTooltip={{eventDiagnosisTooltip()}} matTooltipClass="tooltip-breakline">
                                help</mat-icon>
                              <mat-hint align="end" matTooltip="Public field">
                                <mat-icon>public</mat-icon>
                              </mat-hint>
                            </mat-form-field>

                            <button mat-icon-button color="warn" aria-label="Remove this diagnosis"
                              (click)="removeEventDiagnosis(eventDiagnosisIndex)" matTooltip="Remove this diagnosis">
                              <mat-icon>remove_circle</mat-icon>
                            </button>
                          </div>

                          <div class="submissionReviewErrors">

                            <mat-error color="warn" *ngIf="availableDiagnoses.length < 1">
                              <mat-icon class="icon">error</mat-icon>
                              <span class="alert-text">Please select a species diagnosis to populate event diagnosis
                                selection list.</span>
                            </mat-error>
                          </div>

                        </div>
                        <!-- <mat-divider [inset]="true"></mat-divider> -->
                        <br>
                      </div>
                    </div>

                    <div class="add-content-button">
                      <button mat-button color="primary" matTooltip="Add event diagnosis" (click)="addEventDiagnosis()">
                        <mat-icon>note_add</mat-icon> Add Event Diagnosis
                      </button>
                    </div>

                  </form>
                </div>
              </mat-card-content>
            </mat-card>
            <!-- End event diagnoses section-->

            <!-- Begin event comments section-->
            <h3>
              <mat-icon>comment</mat-icon> Event Comments
            </h3>
            <p>
              <mat-card>
                <mat-card-content>
                  <form [formGroup]="eventSubmissionForm" autocomplete="off">

                    <div formArrayName="new_comments">
                      <div
                        *ngFor="let comments of getEventComments(eventSubmissionForm); let eventCommentIndex = index">

                        <div [formGroupName]="eventCommentIndex">

                          <div class="horizontal-form-container">

                            <mat-form-field class="general-comment-text-area">
                              <textarea matInput maxlength="1000" #comment placeholder="Comment"
                                formControlName="comment"></textarea>
                                <!-- <mat-icon class="hint-hover-text" matSuffix 
                                  matTooltip={{eventCommentTooltip()}} matTooltipClass="tooltip-breakline">
                                  help</mat-icon> -->
                              <mat-hint align="start">{{eventCommentTooltip()}}</mat-hint>
                              <mat-hint align="end">{{comment.value.length}} / 1000</mat-hint>
                            </mat-form-field>

                            <mat-form-field class="form-control">
                              <mat-select placeholder="Type" formControlName="comment_type">
                                <mat-option *ngFor="let commentType of commentTypes" [value]="commentType.id">
                                  {{commentType.name}}</mat-option>
                              </mat-select>
                              <mat-icon class="hint-hover-text" matSuffix 
                                matTooltip={{eventCommentTypeTooltip()}} matTooltipClass="tooltip-breakline">
                                help</mat-icon>
                            </mat-form-field>

                            <button mat-icon-button color="warn" aria-label="Remove this comment"
                              (click)="removeEventComment(eventCommentIndex)" matTooltip="Remove this comment">
                              <mat-icon>remove_circle</mat-icon>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="add-content-button">
                      <button mat-button color="primary" matTooltip="Add comment to this event"
                        (click)="addEventComment()">
                        <mat-icon>add_comment</mat-icon> Add Comment
                      </button>
                    </div>
                  </form>
                </mat-card-content>
              </mat-card>
              <!-- End event comments section-->

              <p>
                <!-- Service request section -->
                <h3>
                  <mat-icon>question_answer</mat-icon> Service Request
                </h3>
                <span>Need help? Request diagnostic services and/or consult (e.g. management
                  suggestions, recommended
                  personal protective gear, etc.) from the USGS National Wildlife Health Center.</span>
                <p>
                  <mat-card>
                    <mat-card-content>

                      <form [formGroup]="eventSubmissionForm" autocomplete="off">
                        <div formGroupName="new_service_request">

                          <mat-radio-group formControlName="request_type">
                            <mat-radio-button [value]="0">No services needed at this time </mat-radio-button>
                              <mat-icon class="hint-hover-text" matSuffix 
                              matTooltip={{serviceRequestNoServicesTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                            <p>
                              <mat-radio-button [value]="1">Request diagnostic and consultative services
                              </mat-radio-button>
                              <mat-icon class="hint-hover-text" matSuffix 
                              matTooltip={{serviceRequestRequestDiaAndConsultTooltip()}} matTooltipClass="tooltip-breakline">
                              help</mat-icon>
                              <p>
                                <mat-radio-button [value]="2">Request consultative services ONLY </mat-radio-button>
                                <mat-icon class="hint-hover-text" matSuffix 
                                matTooltip={{serviceRequestRequestDiaServicesOnlyTooltip()}} matTooltipClass="tooltip-breakline">
                                help</mat-icon>
                          </mat-radio-group>

                          <div class="text-bold text-larger diagnostic-info-text"
                            *ngIf="this.eventSubmissionForm.get('new_service_request').get('request_type').value === 1">
                            For diagnostic services, indicate in comment A) species and numbers of FRESH carcasses
                            available to send, B) whether carcasses are chilled or frozen, and C) if
                            euthanized and how. See <span class="link"><a role="button"
                                (click)="openDiagnosticInfoDialog();">Suitable Specimen Criteria</a></span> for
                            details on suitable specimens. Wait for NWHC approval
                            before shipping.
                          </div>

                          <div formArrayName="new_comments">
                            <div
                              *ngFor="let comments of getServiceRequestComments(eventSubmissionForm); let serviceRequestCommentIndex = index">

                              <div [formGroupName]="serviceRequestCommentIndex">

                                <div class="horizontal-form-container">

                                  <mat-form-field class="general-comment-text-area">
                                    <textarea matInput maxlength="2000" #comment placeholder="Comment"
                                      formControlName="comment"></textarea>
                                      <mat-icon class="hint-hover-text" matSuffix 
                                        matTooltip={{serviceRequestCommentTooltip()}} matTooltipClass="tooltip-breakline">
                                        help
                                      </mat-icon>
                                    <mat-hint align="end">{{comment.value.length}} / 2000</mat-hint>
                                  </mat-form-field>

                                  <button mat-icon-button color="warn" aria-label="Remove this comment"
                                    (click)="removeServiceRequestComment(serviceRequestCommentIndex)"
                                    matTooltip="Remove this comment">
                                    <mat-icon>remove_circle</mat-icon>
                                  </button>
                                </div>
                              </div>
                            </div>
                          </div>

                          <div class="add-content-button"
                            *ngIf="this.eventSubmissionForm.get('new_service_request').get('new_comments').value.length < 1">
                            <button mat-button color="primary" matTooltip="Add comment to this event"
                              (click)="addServiceRequestComment()">
                              <mat-icon>add_comment</mat-icon> Add Comment
                            </button>
                          </div>

                        </div>
                      </form>
                    </mat-card-content>
                  </mat-card>
                  <!-- end Service request section -->

                  <p>
                    <!-- Collaborators section -->
                    <h3>
                      <mat-icon>group</mat-icon> Collaborators
                    </h3>
                    <span>Add collaborators to this event with read or write access. These selections extend the
                      visibility and editibility of your event data to specific Users beyond your own
                      organization.</span>
                    <p>
                      <mat-card>
                        <mat-card-content>

                          <form [formGroup]="eventSubmissionForm" autocomplete="off">
                            <div>

                              <div>
                                <h4>
                                  <mat-icon>lock</mat-icon>Read Only Access
                                </h4>
                                <mat-list role="list">
                                  <mat-list-item *ngIf="readCollaboratorArray.length === 0">No Read Only Collaborators
                                  </mat-list-item>
                                  <mat-list-item *ngFor="let user of readCollaboratorArray" role="listitem">
                                    {{user.first_name}}&nbsp;{{user.last_name}}&nbsp;|&nbsp;{{user.organization_string}}
                                    <button mat-icon-button aria-label="remove collaborator" color="warn"
                                      (click)="removeCollaborator(user.id, 'read')">
                                      <mat-icon>remove_circle</mat-icon>
                                    </button></mat-list-item>
                                </mat-list>
                                <div class="button-row">
                                  <button mat-button color="primary" matTooltip={{collaboratorsAddIndividualTooltip()}}
                                    (click)="addCollaborator('read')">
                                    <mat-icon>person_add</mat-icon> Add Individual
                                  </button>
                                  <button mat-button color="primary"
                                    matTooltip={{collaboratorsAddCircleTooltip()}}
                                    (click)="openCircleChooseDialog('read')">
                                    <mat-icon>group_add</mat-icon> Add Circle
                                  </button>
                                </div>
                              </div>

                              <div>
                                <h4>
                                  <mat-icon>lock_open</mat-icon>Read and Write Access
                                </h4>
                                <mat-list role="list">
                                  <mat-list-item *ngIf="writeCollaboratorArray.length === 0">No Read and Write
                                    Collaborators</mat-list-item>
                                  <mat-list-item *ngFor="let user of writeCollaboratorArray" role="listitem">
                                    {{user.first_name}}&nbsp;{{user.last_name}}&nbsp;|&nbsp;{{user.organization_string}}
                                    <button mat-icon-button aria-label="remove collaborator" color="warn"
                                      (click)="removeCollaborator(user.id, 'write')">
                                      <mat-icon>remove_circle</mat-icon>
                                    </button></mat-list-item>
                                </mat-list>
                                <div class="button-row">
                                  <button mat-button color="primary" matTooltip={{collaboratorsAddIndividualTooltip()}}
                                    (click)="addCollaborator('write')">
                                    <mat-icon>person_add</mat-icon> Add Individual
                                  </button>
                                  <button mat-button color="primary"
                                    matTooltip={{collaboratorsAddCircleTooltip()}}
                                    (click)="openCircleChooseDialog('write')">
                                    <mat-icon>group_add</mat-icon> Add Circle
                                  </button>
                                </div>
                              </div>

                            </div>
                          </form>
                        </mat-card-content>
                      </mat-card>
                      <!-- end Collaborators section -->

                      <mat-divider [inset]="true"></mat-divider>

                      <div class="submissionReviewErrors">

                        <mat-error color="warn" *ngIf="duplicateEventOrgViolation">
                          <mat-icon class="icon">error</mat-icon>
                          <span class="alert-text">Contact organization cannot be duplicated.</span>
                        </mat-error>

                        <mat-error color="warn" *ngIf="locationSpeciesNumbersViolation">
                          <mat-icon class="icon">error</mat-icon>
                          <span class="alert-text">For morbidity/mortality events, there must be at least one value
                            greater
                            than 0
                            between Known Dead, Estimated Dead, Known Sick, and Estimated Sick for at least one species
                            in the event at the time of event creation.</span>
                        </mat-error>

                        <mat-error color="warn" *ngIf="completeEventLocationSpeciesNumbersViolation">
                          <mat-icon class="icon">error</mat-icon>
                          <span class="alert-text">For morbidity/mortality events marked as Complete, there must be at
                            least
                            one value greater
                            than 0
                            between Known Dead, Estimated Dead, Known Sick, and Estimated Sick for all species
                            in the event.</span>
                        </mat-error>

                        <mat-error color="warn" *ngIf="locationStartDatesViolation">
                          <mat-icon class="icon">error</mat-icon>
                          <span class="alert-text">An event must have a start date provided for at least one
                            location.</span>
                        </mat-error>

                        <mat-error color="warn" *ngIf="locationEndDatesViolation">
                          <mat-icon class="icon">error</mat-icon>
                          <span class="alert-text">If an event is marked as complete, it must have end date provided for
                            each location.</span>
                        </mat-error>

                        <mat-error color="warn" *ngIf="speciesDiagnosisViolation">
                          <mat-icon class="icon">error</mat-icon>
                          <span class="alert-text">If an event is marked as complete, all species diagnoses must have a
                            Basis of Diagnosis and Signicance of Diagnosis selected. <br>
                            Non-compliant species diagnoses: <span
                              *ngFor="let item of nonCompliantSpeciesDiagnoses">Location&nbsp;{{item.eventLocationNumber}},&nbsp;Species&nbsp;{{item.locationSpeciesNumber}}&nbsp;({{item.locationSpeciesName}}),&nbsp;Diagnosis&nbsp;{{item.speciesDiagnosisNumber}}&nbsp;({{item.speciesDiagnosisName}})</span>
                          </span>
                        </mat-error>
                      </div>

                      <mat-progress-bar mode="indeterminate " *ngIf="submitLoading " class="event-submit-progress-bar ">
                      </mat-progress-bar>
                      <p>
                        <button mat-raised-button color="primary"
                          (click)="openEventSubmitConfirm(eventSubmissionForm.value)">
                          <mat-icon>pageview</mat-icon> Review Event Submission
                        </button>
                        <p>
                          <button mat-raised-button color="primary"
                            [disabled]="eventSubmissionForm.invalid || duplicateEventOrgViolation || locationSpeciesNumbersViolation || completeEventLocationSpeciesNumbersViolation || locationEndDatesViolation || locationStartDatesViolation || speciesDiagnosisViolation || submitLoading"
                            (click)="submitEvent(eventSubmissionForm.value)">
                            <mat-icon>done</mat-icon> Save Event
                          </button>

                          <div *ngIf="currentUser.role === 1 || currentUser.role === 2">
                            <p>
                              <mat-expansion-panel>
                                <mat-expansion-panel-header>
                                  <mat-panel-title>
                                    Form data JSON
                                  </mat-panel-title>
                                  <mat-panel-description>
                                    JSON format of this form entry, for debugging purposes
                                  </mat-panel-description>
                                </mat-expansion-panel-header>
                                <div class="temporary-form-value-display">
                                  <p>Form Status: {{eventSubmissionForm.status}}
                                    <pre> {{eventSubmissionForm.value | json}} </pre>
                                </div>
                              </mat-expansion-panel>
                            </p>
                          </div>



      </mat-card-content>
    </mat-card>
  </div>