<mat-spinner *ngIf="lookupDataLoading"></mat-spinner>
<div *ngIf="!lookupDataLoading">

  <div class="detailsDiv">
    <mat-card>
      <mat-card-title>
        <span>
          <b>Event Submission</b>
        </span>
      </mat-card-title>
      <mat-card-subtitle>
        <span>
          Submit a wildlife mortality/morbidity or surveillance event
        </span>
      </mat-card-subtitle>
      <mat-card-content *ngIf="!eventDataLoading">

        <form [formGroup]="eventSubmissionForm">

          <div class="horizontal-form-container">



            <mat-form-field class="form-control">
              <mat-select placeholder="Event Type" formControlName="event_type">
                <mat-option *ngFor="let eventType of eventTypes" value="{{eventType.id}}">{{eventType.name}}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field class="form-control">
              <input matInput placeholder="Event Name" formControlName="event_reference">
            </mat-form-field>

            <mat-form-field class="form-control">
              <mat-select placeholder="Legal Status" formControlName="legal_status">
                <mat-option *ngFor="let legalStatus of legalStatuses" value="{{legalStatus.id}}">{{legalStatus.name}}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field class="form-control">
              <input matInput placeholder="Legal Case Number" formControlName="legal_number">
            </mat-form-field>

          </div>

          <div class="horizontal-form-container">

            <mat-form-field class=" form-control event-org-select">
              <mat-select placeholder="Event Organization" formControlName="event_organization">
                <mat-option *ngFor="let organization of organizations" value="{{organization.id}}">{{organization.name}}</mat-option>
              </mat-select>
              <mat-hint align="start">
                <strong>Event organization contact for display to general public, for general inquries</strong>
              </mat-hint>
            </mat-form-field>
          </div>
        </form>

        <p>

          <!--Locations Section-->
          <div>
            <h4>Event Locations</h4>
            <p>
              <form [formGroup]="eventSubmissionForm">

                <div formArrayName="event_locations">
                  <div class="location-container" *ngFor="let eventLocation of getEventLocations(eventSubmissionForm); let i = index">
                    <mat-card class="event-location-card" [formGroupName]="i">
                      <h5>Location {{i+1}}</h5>

                      <div class="horizontal-form-container">
                        <mat-form-field class="form-control">
                          <input matInput [matDatepicker]="startDate" placeholder="Onset Date">
                          <mat-datepicker-toggle matSuffix [for]="startDate"></mat-datepicker-toggle>
                          <mat-datepicker #startDate></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <input matInput [matDatepicker]="endDate" placeholder="End Date">
                          <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
                          <mat-datepicker #endDate></mat-datepicker>
                        </mat-form-field>
                      </div>
                      <br>

                      <div class="horizontal-form-container">

                        <mat-form-field class="form-control">
                          <mat-select placeholder="Country" formControlName="country" (change)="updateAdminLevelOneOptions($event)">
                            <mat-option *ngFor="let country of countries" value="{{country.id}}">{{country.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <mat-select placeholder="State" formControlName="administrative_level_one" (change)="updateAdminLevelTwoOptions($event)">
                            <mat-option *ngFor="let adminLevelOne of adminLevelOnes" value="{{adminLevelOne.id}}">{{adminLevelOne.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <mat-select placeholder="County" formControlName="administrative_level_two">
                            <mat-option *ngFor="let adminLevelTwo of adminLevelTwos" value="{{adminLevelTwo.id}}">{{adminLevelTwo.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>

                      <div class="horizontal-form-container">
                        <mat-form-field class="form-control">
                          <input matInput placeholder="Location Name" formControlName="name">
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <mat-select placeholder="Land Ownership" formControlName="land_ownership">
                            <mat-option *ngFor="let landOwnership of landOwnerships" value="{{landOwnership.id}}">{{landOwnership.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>

                      </div>

                      <div class="horizontal-form-container">
                        <mat-form-field class="form-control">
                          <input matInput placeholder="Latitude" formControlName="latitude">
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <input matInput placeholder="Longitude" formControlName="longitude">
                        </mat-form-field>
                      </div>

                      <div class="vertical-form-container">
                        <mat-form-field class="form-control">
                          <input matInput placeholder="GNIS Standardized Location Name" formControlName="gnis_name">
                        </mat-form-field>

                      </div>

                      <!--Comments Section-->
                      <mat-accordion>
                        <mat-expansion-panel>
                          <mat-expansion-panel-header>
                            <mat-panel-title>
                              Area Description, Environmental Factors, Clinical Signs (Optional)
                            </mat-panel-title>
                            <mat-panel-description>

                            </mat-panel-description>
                          </mat-expansion-panel-header>

                          <div>

                            <mat-form-field class="comment-text-area">
                              <textarea matInput #areaDescription maxlength="1000" minRows="3" placeholder="Area Description" formControlName="area_description"></textarea>
                              <mat-hint align="start" class="hint">
                                <strong>land use, habitat types, other species present, or other additional information that may
                                  be of value such as past occurrences of disease in area, public health warnings, hunting
                                  and agriculture activities, etc.</strong>
                              </mat-hint>
                              <mat-hint align="end">{{areaDescription.value.length}} / 1000</mat-hint>
                            </mat-form-field>

                            <mat-form-field class="comment-text-area">
                              <textarea matInput #envFactors maxlength="1000" placeholder="Environmental Factors" formControlName="environmental_factors"></textarea>
                              <mat-hint align="start">
                                <strong>storms, precipitation, temperature changes, migration, or other that may contribute to stress
                                </strong>
                              </mat-hint>
                              <mat-hint align="end">{{envFactors.value.length}} / 1000</mat-hint>
                            </mat-form-field>

                            <mat-form-field class="comment-text-area">
                              <textarea matInput #clinicalSigns maxlength="1000" placeholder="Clinical Signs" formControlName="clinical_signs"></textarea>
                              <mat-hint align="start">
                                <strong>any unusual behavior or physical appearance</strong>
                              </mat-hint>
                              <mat-hint align="end">{{clinicalSigns.value.length}} / 1000</mat-hint>
                            </mat-form-field>

                          </div>
                        </mat-expansion-panel>

                      </mat-accordion>

                      <!--End Comments Section-->

                      <!--Location Species Section-->
                      <div>
                        <h4>Species Affected</h4>
                        <div formArrayName="location_species">
                          <div class="species-container" *ngFor="let locationSpecies of getLocationSpecies(eventLocation); let j = index">

                            <div class="horizontal-form-container" [formGroupName]="j">
                              <mat-form-field class="form-control ">
                                <mat-select placeholder="Species" formControlName="species">
                                  <mat-option *ngFor="let species of species" value="{{species.id}}">{{species.name}}</mat-option>
                                </mat-select>
                              </mat-form-field>

                              <mat-form-field class=" species-number-control">
                                <input matInput placeholder="# Known Dead" formControlName="dead">
                              </mat-form-field>

                              <mat-form-field class=" species-number-control">
                                <input matInput placeholder="# Estimated Dead" formControlName="estimated_dead">
                              </mat-form-field>

                              <mat-form-field class=" species-number-control">
                                <input matInput placeholder="# Known Sick" formControlName="sick">
                              </mat-form-field>

                              <mat-form-field class=" species-number-control">
                                <input matInput placeholder="# Estimated Sick" formControlName="estimated_sick">
                              </mat-form-field>

                              <mat-form-field class=" species-number-control">
                                <input matInput placeholder="Est. Population at Risk" formControlName="population">
                              </mat-form-field>

                              <mat-form-field class="species-number-control">
                                <mat-select placeholder="Age Bias" formControlName="age_bias">
                                  <mat-option *ngFor="let ageBias of ageBiases" value="{{ageBias.id}}">{{ageBias.name}}</mat-option>
                                </mat-select>
                              </mat-form-field>

                              <mat-form-field class="species-number-control">
                                <mat-select placeholder="Sex Bias" formControlName="sex_bias">
                                  <mat-option *ngFor="let sexBias of sexBiases" value="{{sexBias.id}}">{{sexBias.name}}</mat-option>
                                </mat-select>
                              </mat-form-field>

                              <button mat-button color="warn" (click)="removeLocationSpecies(i, j)">
                                <i class="material-icons">remove_circle</i> Remove</button>

                            </div>
                            <mat-divider [inset]="true"></mat-divider>
                          </div>
                        </div>
                      </div>
                      <div class="button-row">
                        <button mat-button color="primary" (click)="addLocationSpecies(i)">
                          <i class="material-icons">add_circle</i> Add Another Species</button>
                      </div>
                      <!--End Location Species Section-->

                      <p>

                        <!--Location Contacts Section-->
                        <div class="contacts-section-header">
                          <div>
                            <h4>Contacts
                              <button mat-button color="primary" class="event-detail-action-button" (click)="openCreateContactDialog()">
                                <i class="material-icons">person_add</i> Create New Contact</button>
                            </h4>
                          </div>
                        </div>

                        <div formArrayName="location_contacts">
                          <div class="contacts-container" *ngFor="let locationContacts of getLocationContacts(eventLocation); let k = index">

                            <div class="horizontal-form-container" [formGroupName]="k">
                              <mat-form-field class="form-control">
                                <mat-select placeholder="Contact" formControlName="id">
                                  <mat-option *ngFor="let contact of userContacts" [value]="0">John Smith | MN DNR</mat-option>
                                  <!-- <mat-option *ngFor="let contact of userContacts" [value]="contact.id">{{contact.first_name}} {{contact.last_name}}</mat-option> -->
                                </mat-select>
                              </mat-form-field>

                              <mat-form-field class="form-control">
                                <mat-select placeholder="Type" formControlName="contact_type">
                                  <mat-option *ngFor="let contactType of contactTypes" [value]="contactType.id">{{contactType.name}}</mat-option>
                                </mat-select>
                              </mat-form-field>

                              <button mat-button color="accent">
                                <i class="material-icons">pageview</i> View Contact Details</button>

                              <button mat-button color="warn" (click)="removeLocationContacts(i, k)">
                                <i class="material-icons">remove_circle</i> Remove</button>

                            </div>
                            <mat-divider [inset]="true"></mat-divider>
                            <br>
                          </div>
                        </div>

                        <div class="button-row">
                          <button mat-button color="primary" (click)="addLocationContacts(i)">
                            <i class="material-icons">add_circle</i> Add Another Contact</button>

                        </div>
                        <p>

                          <mat-divider [inset]="true"></mat-divider>
                          <p>
                            <button mat-button color="warn" (click)="removeEventLocation(i)">
                              <i class="material-icons">remove_circle</i> Remove this Event Location</button>

                    </mat-card>
                  </div>
                </div>
              </form>
          </div>
          <!-- End Locations Section-->

          <button mat-button color="primary" (click)="addEventLocation()">
            <i class="material-icons">
              add_location
            </i>Add Another Event Location</button>

          <p>
            <button mat-raised-button color="primary">Submit Event</button>
            <div>
              <pre> {{eventSubmissionForm.value | json}} </pre>
            </div>

      </mat-card-content>
    </mat-card>
  </div>