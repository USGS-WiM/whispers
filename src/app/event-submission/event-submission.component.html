<mat-spinner *ngIf="lookupDataLoading"></mat-spinner>
<div *ngIf="!lookupDataLoading">

  <div class="detailsDiv">
    <mat-card>
      <mat-card-title>
        <span>
          <b>Event Submission</b>
        </span>
        <br>
        <span class="text-smaller">
          Submit data for a wildflife mortality/morbidity or surveillance event
        </span>

      </mat-card-title>
      <mat-card-content *ngIf="!eventDataLoading">

        <div class="horizontal-form-container">

          <form [formGroup]="eventSubmissionForm" class="autocomplete-form">

            <mat-form-field class="form-control">
              <mat-select placeholder="Event Type" formControlName="event_type">
                <mat-option *ngFor="let eventType of eventTypes" value="{{eventType.id}}">{{eventType.name}}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field class="form-control">
              <input matInput placeholder="Event Name" formControlName="event_reference">
            </mat-form-field>

            <mat-form-field class="form-control">
              <mat-select placeholder="Legal Status" formControlName="legal_status">
                <mat-option *ngFor="let legalStatus of legalStatuses" value="{{legalStatus.id}}">{{legalStatus.name}}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field class="form-control">
              <input matInput placeholder="Legal Case Number" formControlName="legal_number">
            </mat-form-field>

          </form>

        </div>
        <p>

          <div>
            <h3 class="text-large text-bold">Locations</h3>
            <p>

              <form [formGroup]="eventSubmissionForm">

                <!--Locations Section-->
                <div formArrayName="event_locations">
                  <div class="location-container" *ngFor="let eventLocation of getEventLocations(eventSubmissionForm); let i = index">
                    <mat-card class="event-location-card" [formGroupName]="i">
                      <h5>Location {{i+1}}</h5>

                      <div class="horizontal-form-container">
                        <mat-form-field class="form-control">
                          <input matInput [matDatepicker]="startDate" placeholder="Onset Date">
                          <mat-datepicker-toggle matSuffix [for]="startDate"></mat-datepicker-toggle>
                          <mat-datepicker #startDate></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <input matInput [matDatepicker]="endDate" placeholder="End Date">
                          <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
                          <mat-datepicker #endDate></mat-datepicker>
                        </mat-form-field>

                      </div>
                      <br>

                      <div class="horizontal-form-container">

                        <mat-form-field class="form-control">
                          <mat-select placeholder="Country" formControlName="country" (change)="updateAdminLevelOneOptions($event)">
                            <mat-option *ngFor="let country of countries" value="{{country.id}}">{{country.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <mat-select placeholder="State" formControlName="administrative_level_one" (change)="updateAdminLevelTwoOptions($event)">
                            <mat-option *ngFor="let adminLevelOne of adminLevelOnes" value="{{adminLevelOne.id}}">{{adminLevelOne.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <mat-select placeholder="County" formControlName="administrative_level_two">
                            <mat-option *ngFor="let adminLevelTwo of adminLevelTwos" value="{{adminLevelTwo.id}}">{{adminLevelTwo.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>

                      <div class="horizontal-form-container">
                      </div>

                      <div class="horizontal-form-container">
                      </div>

                      <div class="vertical-form-container">

                        <mat-form-field class="form-control">
                          <!--needs a form control in the event submissin form, or needs to go-->
                          <input matInput placeholder="Nearest Town or Township">
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <input matInput placeholder="Location Name" formControlName="name">
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <mat-select placeholder="Land Ownership" formControlName="land_ownership">
                            <mat-option *ngFor="let landOwnership of landOwnerships" value="{{landOwnership.id}}">{{landOwnership.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <input matInput placeholder="Latitude" formControlName="latitude">
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <input matInput placeholder="Longitude" formControlName="longitude">
                        </mat-form-field>

                        <mat-form-field class="form-control">
                          <input matInput placeholder="GNIS Standardized Location Name" formControlName="gnis_name">
                        </mat-form-field>


                      </div>

                      <h4 class="text-large text-bold">Species Affected</h4>
                      <!--Location Species Section-->
                      <div formArrayName="location_species">
                        <div class="species-container" *ngFor="let locationSpecies of getLocationSpecies(eventLocation); let j = index">

                          <div class="horizontal-form-container" [formGroupName]="j">
                            <mat-form-field class="form-control ">
                              <mat-select placeholder="Species" formControlName="species">
                                <mat-option *ngFor="let species of species" value="{{species.id}}">{{species.name}}</mat-option>
                              </mat-select>
                            </mat-form-field>

                            <mat-form-field class=" species-number-control">
                              <input matInput placeholder="# Known Dead" formControlName="dead">
                            </mat-form-field>

                            <mat-form-field class=" species-number-control">
                              <input matInput placeholder="# Estimated Dead" formControlName="estimated_dead">
                            </mat-form-field>

                            <mat-form-field class=" species-number-control">
                              <input matInput placeholder="# Known Sick" formControlName="sick">
                            </mat-form-field>

                            <mat-form-field class=" species-number-control">
                              <input matInput placeholder="# Estimated Sick" formControlName="estimated_sick">
                            </mat-form-field>

                            <mat-form-field class=" species-number-control">
                              <input matInput placeholder="Est. Population at Risk" formControlName="population">
                            </mat-form-field>

                            <mat-form-field class="species-number-control">
                              <mat-select placeholder="Age Bias" formControlName="age_bias">
                                <mat-option *ngFor="let ageBias of ageBiases" value="{{ageBias.id}}">{{ageBias.name}}</mat-option>
                              </mat-select>
                            </mat-form-field>

                            <mat-form-field class="species-number-control">
                              <mat-select placeholder="Sex Bias" formControlName="sex_bias">
                                <mat-option *ngFor="let sexBias of sexBiases" value="{{sexBias.id}}">{{sexBias.name}}</mat-option>
                              </mat-select>
                            </mat-form-field>

                            <button mat-button color="warn" (click)="removeLocationSpecies(i, j)">
                              <i class="material-icons">remove_circle</i> Remove</button>

                          </div>
                          <mat-divider [inset]="true"></mat-divider>
                        </div>

                      </div>

                      <div class="button-row">
                        <button mat-button color="primary" (click)="addLocationSpecies(i)">
                          <i class="material-icons">add_circle</i> Add Species</button>
                      </div>






                      <p>
                        <mat-divider [inset]="true"></mat-divider>
                        <p>

                          <button mat-button color="warn" (click)="removeEventLocation(i)">
                            <i class="material-icons">
                              remove_circle
                            </i> Remove This Location</button>

                    </mat-card>
                  </div>
                </div>

              </form>


          </div>

          <button mat-raised-button color="primary" (click)="addEventLocation()">
            <i class="material-icons">
              add_location
            </i>Add Location</button>

          <p>
            <div>
              <pre> {{eventSubmissionForm.value | json}} </pre>
            </div>

      </mat-card-content>
    </mat-card>
  </div>